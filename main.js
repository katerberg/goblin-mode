(()=>{"use strict";var t={65:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(81),n=i.n(s),r=i(645),o=i.n(r)()(n());o.push([t.id,"#game{max-width:500px}button{width:36px;height:36px}#character-list-button{display:none;position:absolute;top:0;left:0}#character-list-button.open{display:inline-block}#level-title{display:none;position:absolute;left:40px;top:10px;font-size:18px;color:#fff;z-index:50}#level-title.open{display:inline-block}#character-list-modal{background-color:#fff;z-index:100;display:none;position:absolute;left:0;top:0;width:100%;height:100%}#character-list-modal #character-list{overflow-y:auto}#character-list-modal .title{display:inline-block;font-size:36px}#character-list-modal button.cancel{float:right}#character-list-modal img.sheep-head{width:8%}#warning-message{opacity:0;pointer-events:none;padding:80px 0 30px;background:#000;z-index:20;font-family:sans-serif;position:absolute;bottom:0;font-size:40px;width:100%;text-align:center;letter-spacing:.2em;font-weight:800;color:#000}#warning-message .sub-warning{margin-top:20px;color:#ccc}#warning-message .outside-fire{animation:burningAnimation 1s ease-in-out infinite alternate}#warning-message .inside-fire{animation:burningAnimation .65s ease-in-out infinite alternate}#warning-message.fade-in-animation{animation:fadeIn 1s;opacity:1}#warning-message.fade-out-animation{animation:fadeOut .5s;opacity:0}@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@keyframes fadeOut{0%{opacity:1}100%{opacity:0}}@keyframes burningAnimation{0%{text-shadow:0 0 20px #fefcc9,10px -10px 30px #feec85,-20px -20px 40px #ffae34,20px -40px 50px #ec760c,-20px -60px 60px #cd4606,0 -80px 70px #973716,10px -90px 80px #451b0e}100%{text-shadow:0 0 20px #fefcc9,10px -10px 30px #fefcc9,-20px -20px 40px #feec85,22px -42px 60px #ffae34,-22px -58px 50px #ec760c,0 -82px 80px #cd4606,10px -90px 80px #973716}}html,body{overflow:hidden;overscroll-behavior-y:contain;position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}canvas{width:100%;height:auto}",""]);const a=o},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);s&&o[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},81:t=>{t.exports=function(t){return t[1]}},402:(t,e,i)=>{i.r(e),i.d(e,{Color:()=>At,DEFAULT_HEIGHT:()=>Z,DEFAULT_WIDTH:()=>Q,DIRS:()=>$,Display:()=>it,Engine:()=>Tt,EventQueue:()=>rt,FOV:()=>ct,KEYS:()=>J,Lighting:()=>Ct,Map:()=>yt,Noise:()=>St,Path:()=>kt,RNG:()=>l,Scheduler:()=>at,StringGenerator:()=>st,Text:()=>Mt,Util:()=>Pt});var s={};i.r(s),i.d(s,{capitalize:()=>f,clamp:()=>p,format:()=>d,mod:()=>u});var n={};i.r(n),i.d(n,{add:()=>y,add_:()=>v,fromString:()=>b,hsl2rgb:()=>M,interpolate:()=>S,interpolateHSL:()=>k,lerp:()=>E,lerpHSL:()=>T,multiply:()=>x,multiply_:()=>w,randomize:()=>C,rgb2hsl:()=>P,toHex:()=>V,toRGB:()=>O});var r={};i.r(r),i.d(r,{TYPE_BG:()=>H,TYPE_FG:()=>j,TYPE_NEWLINE:()=>B,TYPE_TEXT:()=>W,measure:()=>X,tokenize:()=>Y});const o=2.3283064365386963e-10;class a{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*o,t=69069*t+1>>>0,this._s1=t*o,t=69069*t+1>>>0,this._s2=t*o,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*o;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),s=Math.min(t,e);return Math.floor(this.getUniform()*(i-s+1))+s}getNormal(t=0,e=1){let i,s,n;do{i=2*this.getUniform()-1,s=2*this.getUniform()-1,n=i*i+s*s}while(n>1||0==n);return t+i*Math.sqrt(-2*Math.log(n)/n)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,s=this.getUniform()*e,n=0;for(i in t)if(n+=t[i],s<n)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new a).setState(this.getState())}}const l=(new a).setSeed(Date.now());class h{getContainer(){return null}setOptions(t){this._options=t}}class c extends h{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}function u(t,e){return(t%e+e)%e}function p(t,e=0,i=1){return t<e?e:t>i?i:t}function f(t){return t.charAt(0).toUpperCase()+t.substring(1)}function d(t,...e){let i=d.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(s,n,r,o){if("%"==t.charAt(o-1))return s.substring(1);if(!e.length)return s;let a=e[0],l=(n||r).split(","),h=l.shift()||"",c=i[h.toLowerCase()];if(!c)return s;a=e.shift();let u=a[c].apply(a,l),p=h.charAt(0);return p!=p.toLowerCase()&&(u=f(u)),u}))}d.map={s:"toString"};class _ extends c{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,s,n,r,o]=t,a=[(i+1)*this._spacingX,s*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=o,this._fill(a[0],a[1])),!n)return;this._ctx.fillStyle=r;let l=[].concat(n);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,s=e/(2+1.5*(this._options.height-1)),n=Math.min(i,s),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let a=o/100;n=Math.floor(n)+1;let l=2*n/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let s=i/this._options.height;return u(e=Math.floor(e/s),2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,s=this._options.border;const n=this._ctx;n.beginPath(),this._options.transpose?(n.moveTo(t-i+s,e),n.lineTo(t-i/2+s,e+this._spacingX-s),n.lineTo(t+i/2-s,e+this._spacingX-s),n.lineTo(t+i-s,e),n.lineTo(t+i/2-s,e-this._spacingX+s),n.lineTo(t-i/2+s,e-this._spacingX+s),n.lineTo(t-i+s,e)):(n.moveTo(t,e-i+s),n.lineTo(t+this._spacingX-s,e-i/2+s),n.lineTo(t+this._spacingX-s,e+i/2-s),n.lineTo(t,e+i-s),n.lineTo(t-this._spacingX+s,e+i/2-s),n.lineTo(t-this._spacingX+s,e-i/2+s),n.lineTo(t,e-i+s)),n.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,s;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",s="width"):(i="width",s="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[s]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}const g=(()=>{class t extends c{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,i){t.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(t){let e,[i,s,n,r,o]=t,a=""+n+r+o;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=o,i.fillRect(t,t,e.width-t,e.height-t),n){i.fillStyle=r,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(n);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,i*this._spacingX,s*this._spacingY)}_drawNoCache(t,e){let[i,s,n,r,o]=t;if(e){let t=this._options.border;this._ctx.fillStyle=o,this._ctx.fillRect(i*this._spacingX+t,s*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!n)return;this._ctx.fillStyle=r;let a=[].concat(n);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(i+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),s=Math.floor(e/this._options.height),n=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=n;let o=r/100*s/i;return o>1&&(s=Math.floor(s/o)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class m extends c{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,s,n,r,o]=t,a=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*a,s*l,a,l):(this._ctx.fillStyle=o,this._ctx.fillRect(i*a,s*l,a,l))),!n)return;let h=[].concat(n),c=[].concat(r),u=[].concat(o);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);if(this._options.tileColorize){let n=this._colorCanvas,r=n.getContext("2d");r.globalCompositeOperation="source-over",r.clearRect(0,0,a,l);let o=c[t],h=u[t];r.drawImage(this._options.tileSet,e[0],e[1],a,l,0,0,a,l),"transparent"!=o&&(r.fillStyle=o,r.globalCompositeOperation="source-atop",r.fillRect(0,0,a,l)),"transparent"!=h&&(r.fillStyle=h,r.globalCompositeOperation="destination-over",r.fillRect(0,0,a,l)),this._ctx.drawImage(n,i*a,s*l,a,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,l,i*a,s*l,a,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}function b(t){let e,i;if(t in K)e=K[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map((t=>parseInt(t,16)));if(3==i.length)e=i.map((t=>17*t));else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map((t=>parseInt(t))):[0,0,0];K[t]=e}return e.slice()}function y(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let s=0;s<e.length;s++)i[t]+=e[s][t];return i}function v(t,...e){for(let i=0;i<3;i++)for(let s=0;s<e.length;s++)t[i]+=e[s][i];return t}function x(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let s=0;s<e.length;s++)i[t]*=e[s][t]/255;i[t]=Math.round(i[t])}return i}function w(t,...e){for(let i=0;i<3;i++){for(let s=0;s<e.length;s++)t[i]*=e[s][i]/255;t[i]=Math.round(t[i])}return t}function S(t,e,i=.5){let s=t.slice();for(let n=0;n<3;n++)s[n]=Math.round(s[n]+i*(e[n]-t[n]));return s}const E=S;function k(t,e,i=.5){let s=P(t),n=P(e);for(let t=0;t<3;t++)s[t]+=i*(n[t]-s[t]);return M(s)}const T=k;function C(t,e){e instanceof Array||(e=Math.round(l.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(l.getNormal(0,e[t])):e;return i}function P(t){let e,i=t[0]/255,s=t[1]/255,n=t[2]/255,r=Math.max(i,s,n),o=Math.min(i,s,n),a=0,l=(r+o)/2;if(r==o)e=0;else{let t=r-o;switch(e=l>.5?t/(2-r-o):t/(r+o),r){case i:a=(s-n)/t+(s<n?6:0);break;case s:a=(n-i)/t+2;break;case n:a=(i-s)/t+4}a/=6}return[a,e,l]}function A(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function M(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let i=t[1],s=e<.5?e*(1+i):e+i-e*i,n=2*e-s,r=A(n,s,t[0]+1/3),o=A(n,s,t[0]),a=A(n,s,t[0]-1/3);return[Math.round(255*r),Math.round(255*o),Math.round(255*a)]}}function O(t){return`rgb(${t.map((t=>p(t,0,255))).join(",")})`}function V(t){return`#${t.map((t=>p(t,0,255).toString(16).padStart(2,"0"))).join("")}`}const K={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class R extends h{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",(()=>this._updateTexture(e))):this._updateTexture(e)}draw(t,e){const i=this._gl,s=this._options;let[n,r,o,a,l]=t,h=i.canvas.height-(r+1)*s.tileHeight;if(i.scissor(n*s.tileWidth,h,s.tileWidth,s.tileHeight),e&&(s.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...U(l)),i.clear(i.COLOR_BUFFER_BIT)),!o)return;let c=[].concat(o),u=[].concat(l),p=[].concat(a);i.uniform2fv(this._uniforms.targetPosRel,[n,r]);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,s.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),s.tileColorize&&(i.uniform4fv(this._uniforms.tint,U(p[t])),i.uniform4fv(this._uniforms.bg,U(u[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...U(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const s=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s)||"");const n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const r=t.createProgram();if(t.attachShader(r,s),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(r)||"");return r}(t,N,I);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),D.forEach((i=>this._uniforms[i]=t.getUniformLocation(e,i))),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const D=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],N="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),I="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let L={};function U(t){if(!(t in L)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=b(t).map((t=>t/255)),e.push(1);L[t]=e}return L[t]}function z(t){const e=6/256;let i=b(t);return 36*Math.floor(i[0]*e)+6*Math.floor(i[1]*e)+1*Math.floor(i[2]*e)+16}class G extends h{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map(((t,i)=>Math.floor((t-e[i])/2)))}clear(){process.stdout.write(`[0;48;5;${z(this._options.bg)}m[2J`)}draw(t,e){let[i,s,n,r,o]=t,a=this._offset[0]+i,l=this._offset[1]+s,h=this.computeSize();if(a<0||a>=h[0])return;if(l<0||l>=h[1])return;if(a===this._cursor[0]&&l===this._cursor[1]||(process.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(a,l)),this._cursor[0]=a,this._cursor[1]=l),e&&(n||(n=" ")),!n)return;let c=function(t,e){return`[0;38;5;${z(t)};48;5;${z(e)}m`}(r,o);if(c!==this._lastColor&&(process.stdout.write(c),this._lastColor=c),"\t"!=n){let t=[].concat(n);process.stdout.write(t[0])}this._cursor[0]++,this._cursor[0]>=h[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const F=/%([bc]){([^}]*)}/g,W=0,B=1,j=2,H=3;function X(t,e){let i={width:0,height:1},s=Y(t,e),n=0;for(let t=0;t<s.length;t++){let e=s[t];switch(e.type){case W:n+=e.value.length;break;case B:i.height++,i.width=Math.max(i.width,n),n=0}}return i.width=Math.max(i.width,n),i}function Y(t,e){let i=[],s=0;t.replace(F,(function(e,n,r,o){let a=t.substring(s,o);return a.length&&i.push({type:W,value:a}),i.push({type:"c"==n?j:H,value:r.trim()}),s=o+e.length,""}));let n=t.substring(s);return n.length&&i.push({type:W,value:n}),function(t,e){e||(e=1/0);let i=0,s=0,n=-1;for(;i<t.length;){let r=t[i];if(r.type==B&&(s=0,n=-1),r.type!=W){i++;continue}for(;0==s&&" "==r.value.charAt(0);)r.value=r.value.substring(1);let o=r.value.indexOf("\n");if(-1!=o){r.value=q(t,i,o,!0);let e=r.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();r.value=e.join("")}if(r.value.length){if(s+r.value.length>e){let o=-1;for(;;){let t=r.value.indexOf(" ",o+1);if(-1==t)break;if(s+t>e)break;o=t}if(-1!=o)r.value=q(t,i,o,!0);else if(-1!=n){let e=t[n],s=e.value.lastIndexOf(" ");e.value=q(t,n,s,!0),i=n}else r.value=q(t,i,e-s,!1)}else s+=r.value.length,-1!=r.value.indexOf(" ")&&(n=i);i++}else t.splice(i,1)}t.push({type:B});let r=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case W:r=i;break;case B:if(r){let t=r.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();r.value=t.join("")}r=null}}return t.pop(),t}(i,e)}function q(t,e,i,s){let n={type:B},r={type:W,value:t[e].value.substring(i+(s?1:0))};return t.splice(e+1,0,n,r),t[e].value.substring(0,i)}let Q=80,Z=25;const $={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},J={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},tt={hex:_,rect:g,tile:m,"tile-gl":R,term:G},et={width:Q,height:Z,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1},it=(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},et,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let s=[this._options.bg,this._options.fg];this.draw(t,e,null,null,s[i%s.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=tt[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,s,n){s||(s=this._options.fg),n||(n=this._options.bg);let r=`${t},${e}`;this._data[r]=[t,e,i,s,n],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[r]=!0)}drawOver(t,e,i,s,n){const r=`${t},${e}`,o=this._data[r];o?(o[2]=i||o[2],o[3]=s||o[3],o[4]=n||o[4]):this.draw(t,e,i,s,n)}drawText(t,e,i,s){let n=null,r=null,o=t,a=e,l=1;s||(s=this._options.width-t);let h=Y(i,s);for(;h.length;){let e=h.shift();switch(e.type){case W:let i=!1,s=!1,h=!1,c=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),u=e.value.charAt(t);if("term"===this._options.layout){let t=l>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||l>=43360&&l<=43391){this.draw(o+0,a,u,n,r),this.draw(o+1,a,"\t",n,r),o+=2;continue}}h=l>65280&&l<65377||l>65500&&l<65512||l>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||h||i||o++,h&&!s&&o++,this.draw(o++,a,u,n,r),s=i,c=h}break;case j:n=e.value||null;break;case H:r=e.value||null;break;case B:o=t,a++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}return t.Rect=g,t.Hex=_,t.Tile=m,t.TileGL=R,t.Term=G,t})();class st{constructor(t){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let t=[this._sample(this._prefix)];for(;t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))}observe(t){let e=this._split(t);for(let t=0;t<e.length;t++)this._priorValues[e[t]]=this._options.prior;e=this._prefix.concat(e).concat(this._suffix);for(let t=this._options.order;t<e.length;t++){let i=e.slice(t-this._options.order,t),s=e[t];for(let t=0;t<i.length;t++){let e=i.slice(t);this._observeEvent(e,s)}}}getStats(){let t=[],e=Object.keys(this._priorValues).length;e--,t.push("distinct samples: "+e);let i=Object.keys(this._data).length,s=0;for(let t in this._data)s+=Object.keys(this._data[t]).length;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+s),t.join(", ")}_split(t){return t.split(this._options.words?/\s+/:"")}_join(t){return t.join(this._options.words?" ":"")}_observeEvent(t,e){let i=this._join(t);i in this._data||(this._data[i]={});let s=this._data[i];e in s||(s[e]=0),s[e]++}_sample(t){t=this._backoff(t);let e=this._join(t),i=this._data[e],s={};if(this._options.prior){for(let t in this._priorValues)s[t]=this._priorValues[t];for(let t in i)s[t]+=i[t]}else s=i;return l.getWeightedValue(s)}_backoff(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t}}class nt{constructor(){this.heap=[],this.timestamp=0}lessThan(t,e){return t.key==e.key?t.timestamp<e.timestamp:t.key<e.key}shift(t){this.heap=this.heap.map((({key:e,value:i,timestamp:s})=>({key:e+t,value:i,timestamp:s})))}len(){return this.heap.length}push(t,e){this.timestamp+=1;const i=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:e}),this.updateUp(i)}pop(){if(0==this.len())throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let e=0;e<this.len();e++)if(t==this.heap[e].value)return this.heap[e];return null}remove(t){let e=null;for(let i=0;i<this.len();i++)t==this.heap[i].value&&(e=i);if(null===e)return!1;if(this.len()>1){let i=this.heap.pop();return i.value!=t&&(this.heap[e]=i,this.updateDown(e)),!0}return this.heap.pop(),!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,e){const i=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=i}minNode(t){const e=t.filter(this.existNode.bind(this));let i=e[0];for(const t of e)this.lessThan(this.heap[t],this.heap[i])&&(i=t);return i}updateUp(t){if(0==t)return;const e=this.parentNode(t);this.existNode(e)&&this.lessThan(this.heap[t],this.heap[e])&&(this.swap(t,e),this.updateUp(e))}updateDown(t){const e=this.leftChildNode(t),i=this.rightChildNode(t);if(!this.existNode(e))return;const s=this.minNode([t,e,i]);s!=t&&(this.swap(t,s),this.updateDown(s))}debugPrint(){console.log(this.heap)}}class rt{constructor(){this._time=0,this._events=new nt}getTime(){return this._time}clear(){return this._events=new nt,this}add(t,e){this._events.push(t,e)}get(){if(!this._events.len())return null;let{key:t,value:e}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),e}getEventTime(t){const e=this._events.find(t);if(e){const{key:t}=e;return t}}remove(t){return this._events.remove(t)}}class ot{constructor(){this._queue=new rt,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}const at={Simple:class extends ot{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends ot{add(t,e,i){return this._queue.add(t,void 0!==i?i:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends ot{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,i){return this._queue.add(t,i||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};class lt{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,i){let s,n,r,o=[];switch(this._options.topology){case 4:n=1,r=[0,1],s=[$[8][7],$[8][1],$[8][3],$[8][5]];break;case 6:s=$[6],n=1,r=[-1,1];break;case 8:s=$[4],n=2,r=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let a=t+r[0]*i,l=e+r[1]*i;for(let t=0;t<s.length;t++)for(let e=0;e<i*n;e++)o.push([a,l]),a+=s[t][0],l+=s[t][1];return o}}const ht=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],ct={DiscreteShadowcasting:class extends lt{compute(t,e,i,s){if(s(t,e,0,1),!this._lightPasses(t,e))return;let n,r,o,a,l,h=[];for(let c=1;c<=i;c++){let i=this._getCircle(t,e,c),u=360/i.length;for(let t=0;t<i.length;t++)if(o=i[t][0],a=i[t][1],n=u*(t-.5),r=n+u,l=!this._lightPasses(o,a),this._visibleCoords(Math.floor(n),Math.ceil(r),l,h)&&s(o,a,c,1),2==h.length&&0==h[0]&&360==h[1])return}}_visibleCoords(t,e,i,s){if(t<0){let n=this._visibleCoords(0,e,i,s),r=this._visibleCoords(360+t,360,i,s);return n||r}let n=0;for(;n<s.length&&s[n]<t;)n++;if(n==s.length)return i&&s.push(t,e),!0;let r=0;if(n%2){for(;n<s.length&&s[n]<e;)n++,r++;return 0!=r&&(i&&(r%2?s.splice(n-r,r,e):s.splice(n-r,r)),!0)}for(;n<s.length&&s[n]<e;)n++,r++;return(t!=s[n-r]||1!=r)&&(i&&(r%2?s.splice(n-r,r,t):s.splice(n-r,r,t,e)),!0)}},PreciseShadowcasting:class extends lt{compute(t,e,i,s){if(s(t,e,0,1),!this._lightPasses(t,e))return;let n,r,o,a,l,h,c=[];for(let u=1;u<=i;u++){let i=this._getCircle(t,e,u),p=i.length;for(let t=0;t<p;t++)if(n=i[t][0],r=i[t][1],a=[t?2*t-1:2*p-1,2*p],l=[2*t+1,2*p],o=!this._lightPasses(n,r),h=this._checkVisibility(a,l,o,c),h&&s(n,r,u,h),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return}}_checkVisibility(t,e,i,s){if(t[0]>e[0])return(this._checkVisibility(t,[t[1],t[1]],i,s)+this._checkVisibility([0,1],e,i,s))/2;let n=0,r=!1;for(;n<s.length;){let e=s[n],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0!=i||n%2||(r=!0);break}n++}let o=s.length,a=!1;for(;o--;){let t=s[o],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0==i&&o%2&&(a=!0);break}}let l,h=!0;if((n==o&&(r||a)||r&&a&&n+1==o&&o%2||n>o&&n%2)&&(h=!1),!h)return 0;let c=o-n+1;if(c%2)if(n%2){let t=s[n];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(n,c,e)}else{let e=s[o];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(n,c,t)}else{if(!(n%2))return i&&s.splice(n,c,t,e),1;{let t=s[n],e=s[o];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(n,c)}}return l/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends lt{compute(t,e,i,s){s(t,e,0,1);for(let n=0;n<ht.length;n++)this._renderOctant(t,e,ht[n],i,s)}compute180(t,e,i,s,n){n(t,e,0,1);let r=(s-1+8)%8,o=(s-2+8)%8,a=(s+1+8)%8;this._renderOctant(t,e,ht[o],i,n),this._renderOctant(t,e,ht[r],i,n),this._renderOctant(t,e,ht[s],i,n),this._renderOctant(t,e,ht[a],i,n)}compute90(t,e,i,s,n){n(t,e,0,1);let r=(s-1+8)%8;this._renderOctant(t,e,ht[s],i,n),this._renderOctant(t,e,ht[r],i,n)}_renderOctant(t,e,i,s,n){this._castVisibility(t,e,1,1,0,s+1,i[0],i[1],i[2],i[3],n)}_castVisibility(t,e,i,s,n,r,o,a,l,h,c){if(!(s<n))for(let u=i;u<=r;u++){let i=-u-1,p=-u,f=!1,d=0;for(;i<=0;){i+=1;let _=t+i*o+p*a,g=e+i*l+p*h,m=(i-.5)/(p+.5),b=(i+.5)/(p-.5);if(!(b>s)){if(m<n)break;if(i*i+p*p<r*r&&c(_,g,u,1),f){if(!this._lightPasses(_,g)){d=b;continue}f=!1,s=d}else!this._lightPasses(_,g)&&u<r&&(f=!0,this._castVisibility(t,e,u+1,s,m,r,o,a,l,h,c),d=b)}}if(f)break}}}};class ut{constructor(t=Q,e=Z){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let s=0;s<this._height;s++)e[i].push(t)}return e}}class pt extends ut{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class ft{}class dt extends ft{constructor(t,e,i,s,n,r){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=s,this._doors={},void 0!==n&&void 0!==r&&this.addDoor(n,r)}static createRandomAt(t,e,i,s,n){let r=n.roomWidth[0],o=n.roomWidth[1],a=l.getUniformInt(r,o);r=n.roomHeight[0],o=n.roomHeight[1];let h=l.getUniformInt(r,o);if(1==i){let i=e-Math.floor(l.getUniform()*h);return new this(t+1,i,t+a,i+h-1,t,e)}if(-1==i){let i=e-Math.floor(l.getUniform()*h);return new this(t-a,i,t-1,i+h-1,t,e)}if(1==s){let i=t-Math.floor(l.getUniform()*a);return new this(i,e+1,i+a-1,e+h,t,e)}if(-1==s){let i=t-Math.floor(l.getUniform()*a);return new this(i,e-h,i+a-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let s=i.roomWidth[0],n=i.roomWidth[1],r=l.getUniformInt(s,n);s=i.roomHeight[0],n=i.roomHeight[1];let o=l.getUniformInt(s,n),a=t-Math.floor(l.getUniform()*r),h=e-Math.floor(l.getUniform()*o);return new this(a,h,a+r-1,h+o-1)}static createRandom(t,e,i){let s=i.roomWidth[0],n=i.roomWidth[1],r=l.getUniformInt(s,n);s=i.roomHeight[0],n=i.roomHeight[1];let o=l.getUniformInt(s,n),a=t-r-1,h=e-o-1,c=1+Math.floor(l.getUniform()*a),u=1+Math.floor(l.getUniform()*h);return new this(c,u,c+r-1,u+o-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,n=this._y2+1;for(let r=e;r<=i;r++)for(let o=s;o<=n;o++)r!=e&&r!=i&&o!=s&&o!=n||t(r,o)||this.addDoor(r,o);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,s=this._x2+1,n=this._y1-1,r=this._y2+1;for(let o=i;o<=s;o++)for(let a=n;a<=r;a++)if(o==i||o==s||a==n||a==r){if(!t(o,a))return!1}else if(!e(o,a))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,n=this._y2+1,r=0;for(let o=e;o<=i;o++)for(let a=s;a<=n;a++)r=o+","+a in this._doors?2:o==e||o==i||a==s||a==n?1:0,t(o,a,r)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class _t extends ft{constructor(t,e,i,s){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=s,this._endsWithAWall=!0}static createRandomAt(t,e,i,s,n){let r=n.corridorLength[0],o=n.corridorLength[1],a=l.getUniformInt(r,o);return new this(t,e,t+i*a,e+s*a)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,s=this._startY,n=this._endX-i,r=this._endY-s,o=1+Math.max(Math.abs(n),Math.abs(r));n&&(n/=Math.abs(n)),r&&(r/=Math.abs(r));let a=r,l=-n,h=!0;for(let c=0;c<o;c++){let u=i+c*n,p=s+c*r;if(e(u,p)||(h=!1),t(u+a,p+l)||(h=!1),t(u-a,p-l)||(h=!1),!h){o=c,this._endX=u-n,this._endY=p-r;break}}if(0==o)return!1;if(1==o&&t(this._endX+n,this._endY+r))return!1;let c=!t(this._endX+n+a,this._endY+r+l),u=!t(this._endX+n-a,this._endY+r-l);return this._endsWithAWall=t(this._endX+n,this._endY+r),!c&&!u||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,s=this._endX-e,n=this._endY-i,r=1+Math.max(Math.abs(s),Math.abs(n));s&&(s/=Math.abs(s)),n&&(n/=Math.abs(n));for(let o=0;o<r;o++)t(e+o*s,i+o*n,0);return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,s=this._endX-e,n=this._endY-i;s&&(s/=Math.abs(s)),n&&(n/=Math.abs(n));let r=n,o=-s;t(this._endX+s,this._endY+n),t(this._endX+r,this._endY+o),t(this._endX-r,this._endY-o)}}const gt={room:dt,corridor:_t};function mt(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function bt(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}const yt={Arena:class extends ut{create(t){let e=this._width-1,i=this._height-1;for(let s=0;s<=e;s++)for(let n=0;n<=i;n++)t(s,n,s&&n&&s<e&&n<i?0:1);return this}},Uniform:class extends pt{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=dt.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=l.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=l.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,s=e.getCenter(),n=null;for(let e=0;e<t.length;e++){let r=t[e],o=r.getCenter(),a=o[0]-s[0],l=o[1]-s[1],h=a*a+l*l;h<i&&(i=h,n=r)}return n}_connectRooms(t,e){let i,s,n,r,o,a,l,h=t.getCenter(),c=e.getCenter(),u=c[0]-h[0],p=c[1]-h[1];if(Math.abs(u)<Math.abs(p)?(n=p>0?2:0,r=(n+2)%4,o=e.getLeft(),a=e.getRight(),l=0):(n=u>0?1:3,r=(n+2)%4,o=e.getTop(),a=e.getBottom(),l=1),i=this._placeInWall(t,n),!i)return!1;if(i[l]>=o&&i[l]<=a){s=i.slice();let t=0;switch(r){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}s[(l+1)%2]=t,this._digLine([i,s])}else if(i[l]<o-1||i[l]>a+1){let t=i[l]-c[l],n=0;switch(r){case 0:case 1:n=t<0?3:1;break;case 2:case 3:n=t<0?1:3}if(r=(r+n)%4,s=this._placeInWall(e,r),!s)return!1;let o=[0,0];o[l]=i[l];let a=(l+1)%2;o[a]=s[a],this._digLine([i,o,s])}else{let t=(l+1)%2;if(s=this._placeInWall(e,r),!s)return!1;let n=Math.round((s[t]+i[t])/2),o=[0,0],a=[0,0];o[l]=i[l],o[t]=n,a[l]=s[l],a[t]=n,this._digLine([i,o,a,s])}return t.addDoor(i[0],i[1]),e.addDoor(s[0],s[1]),l=this._unconnected.indexOf(t),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(t)),l=this._unconnected.indexOf(e),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],s=[0,0],n=0;switch(e){case 0:s=[1,0],i=[t.getLeft(),t.getTop()-1],n=t.getRight()-t.getLeft()+1;break;case 1:s=[0,1],i=[t.getRight()+1,t.getTop()],n=t.getBottom()-t.getTop()+1;break;case 2:s=[1,0],i=[t.getLeft(),t.getBottom()+1],n=t.getRight()-t.getLeft()+1;break;case 3:s=[0,1],i=[t.getLeft()-1,t.getTop()],n=t.getBottom()-t.getTop()+1}let r=[],o=-2;for(let t=0;t<n;t++){let e=i[0]+t*s[0],n=i[1]+t*s[1];r.push(null),1==this._map[e][n]?o!=t-1&&(r[t]=[e,n]):(o=t,t&&(r[t-1]=null))}for(let t=r.length-1;t>=0;t--)r[t]||r.splice(t,1);return r.length?l.getItem(r):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],s=t[e],n=new _t(i[0],i[1],s[0],s[1]);n.create(this._digCallback),this._corridors.push(n)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends ut{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=$[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=l.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,s=this._options.survive;for(let t=0;t<this._height;t++){let n=1,r=0;6==this._options.topology&&(n=2,r=t%2);for(let o=r;o<this._width;o+=n){let n=this._map[o][t],r=this._getNeighbors(o,t);n&&-1!=s.indexOf(r)?e[o][t]=1:n||-1==i.indexOf(r)||(e[o][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,s=0;6==this._options.topology&&(i=2,s=e%2);for(let n=s;n<this._width;n+=i)t(n,e,this._map[n][e])}}_getNeighbors(t,e){let i=0;for(let s=0;s<this._dirs.length;s++){let n=this._dirs[s],r=t+n[0],o=e+n[1];r<0||r>=this._width||o<0||o>=this._height||(i+=1==this._map[r][o]?1:0)}return i}connect(t,e,i){e||(e=0);let s=[],n={},r=1,o=[0,0];6==this._options.topology&&(r=2,o=[0,1]);for(let t=0;t<this._height;t++)for(let i=o[t%2];i<this._width;i+=r)if(this._freeSpace(i,t,e)){let e=[i,t];n[this._pointKey(e)]=e,s.push([i,t])}let a=s[l.getUniformInt(0,s.length-1)],h=this._pointKey(a),c={};for(c[h]=a,delete n[h],this._findConnected(c,n,[a],!1,e);Object.keys(n).length>0;){let t=this._getFromTo(c,n),s=t[0],r=t[1],o={};o[this._pointKey(s)]=s,this._findConnected(o,n,[s],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,r,s,c,n,e,i);for(let t in o){let i=o[t];this._map[i[0]][i[1]]=e,c[t]=i,delete n[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,s=[0,0],n=[0,0],r=Object.keys(t),o=Object.keys(e);for(let a=0;a<5;a++){if(r.length<o.length){let i=r;n=t[i[l.getUniformInt(0,i.length-1)]],s=this._getClosest(n,e)}else{let i=o;s=e[i[l.getUniformInt(0,i.length-1)]],n=this._getClosest(s,t)}if(i=(s[0]-n[0])*(s[0]-n[0])+(s[1]-n[1])*(s[1]-n[1]),i<64)break}return[s,n]}_getClosest(t,e){let i=null,s=null;for(let n in e){let r=e[n],o=(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]);(null==s||o<s)&&(s=o,i=r)}return i}_findConnected(t,e,i,s,n){for(;i.length>0;){let r,o=i.splice(0,1)[0];r=6==this._options.topology?[[o[0]+2,o[1]],[o[0]+1,o[1]-1],[o[0]-1,o[1]-1],[o[0]-2,o[1]],[o[0]-1,o[1]+1],[o[0]+1,o[1]+1]]:[[o[0]+1,o[1]],[o[0]-1,o[1]],[o[0],o[1]+1],[o[0],o[1]-1]];for(let o=0;o<r.length;o++){let a=this._pointKey(r[o]);null==t[a]&&this._freeSpace(r[o][0],r[o][1],n)&&(t[a]=r[o],s||delete e[a],i.push(r[o]))}}}_tunnelToConnected(t,e,i,s,n,r){let o,a;e[0]<t[0]?(o=e,a=t):(o=t,a=e);for(let t=o[0];t<=a[0];t++){this._map[t][o[1]]=n;let e=[t,o[1]],r=this._pointKey(e);i[r]=e,delete s[r]}r&&o[0]<a[0]&&r(o,[a[0],o[1]]);let l=a[0];e[1]<t[1]?(o=e,a=t):(o=t,a=e);for(let t=o[1];t<a[1];t++){this._map[l][t]=n;let e=[l,t],r=this._pointKey(e);i[r]=e,delete s[r]}r&&o[1]<a[1]&&r([a[0],o[1]],[a[0],a[1]])}_tunnelToConnected6(t,e,i,s,n,r){let o,a;e[0]<t[0]?(o=e,a=t):(o=t,a=e);let l=o[0],h=o[1];for(;l!=a[0]||h!=a[1];){let t=2;h<a[1]?(h++,t=1):h>a[1]&&(h--,t=1),l<a[0]?l+=t:l>a[0]||a[1]%2?l-=t:l+=t,this._map[l][h]=n;let e=[l,h],r=this._pointKey(e);i[r]=e,delete s[r]}r&&r(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends pt{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,s=Date.now();do{if(i=0,Date.now()-s>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),n=parseInt(e[0]),r=parseInt(e[1]),o=this._getDiggingDirection(n,r);if(!o)continue;let a=0;do{if(a++,this._tryFeature(n,r,o[0],o[1])){this._removeSurroundingWalls(n,r),this._removeSurroundingWalls(n-o[0],r-o[1]);break}}while(a<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=dt.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls)2==this._walls[i]?e.push(i):t.push(i);let i=e.length?e:t;if(!i.length)return null;let s=l.getItem(i.sort());return delete this._walls[s],s}_tryFeature(t,e,i,s){let n=l.getWeightedValue(this._features),r=gt[n].createRandomAt(t,e,i,s,this._options);return!!r.isValid(this._isWallCallback,this._canBeDugCallback)&&(r.create(this._digCallback),r instanceof dt&&this._rooms.push(r),r instanceof _t&&(r.createPriorityWalls(this._priorityWallCallback),this._corridors.push(r)),!0)}_removeSurroundingWalls(t,e){let i=$[4];for(let s=0;s<i.length;s++){let n=i[s],r=t+n[0],o=e+n[1];delete this._walls[r+","+o],r=t+2*n[0],o=e+2*n[1],delete this._walls[r+","+o]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,s=$[4];for(let n=0;n<s.length;n++){let r=s[n],o=t+r[0],a=e+r[1];if(!this._map[o][a]){if(i)return null;i=r}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}},EllerMaze:class extends ut{create(t){let e,i=this._fillMap(1),s=Math.ceil((this._width-2)/2),n=9/24,r=[],o=[];for(let t=0;t<s;t++)r.push(t),o.push(t);for(r.push(s-1),e=1;e+3<this._height;e+=2)for(let t=0;t<s;t++){let s=2*t+1,a=e;i[s][a]=0,t!=r[t+1]&&l.getUniform()>n&&(mt(t,r,o),i[s+1][a]=0),t!=r[t]&&l.getUniform()>n?bt(t,r,o):i[s][a+1]=0}for(let t=0;t<s;t++){let s=2*t+1,a=e;i[s][a]=0,t!=r[t+1]&&(t==r[t]||l.getUniform()>n)&&(mt(t,r,o),i[s+1][a]=0),bt(t,r,o)}for(let e=0;e<this._width;e++)for(let s=0;s<this._height;s++)t(e,s,i[e][s]);return this}},DividedMaze:class extends ut{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let s=0;s<i;s++){let n=0==t||0==s||t+1==e||s+1==i;this._map[t].push(n?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let s=0;s<e;s++)for(let e=0;e<i;e++)t(s,e,this._map[s][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let s=this._map[i][t[1]-1],n=this._map[i][t[3]+1];!s||!n||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let s=this._map[t[0]-1][e],n=this._map[t[2]+1][e];!s||!n||e%2||i.push(e)}if(!e.length||!i.length)return;let s=l.getItem(e),n=l.getItem(i);this._map[s][n]=1;let r=[],o=[];r.push(o);for(let e=t[0];e<s;e++)this._map[e][n]=1,e%2&&o.push([e,n]);o=[],r.push(o);for(let e=s+1;e<=t[2];e++)this._map[e][n]=1,e%2&&o.push([e,n]);o=[],r.push(o);for(let e=t[1];e<n;e++)this._map[s][e]=1,e%2&&o.push([s,e]);o=[],r.push(o);for(let e=n+1;e<=t[3];e++)this._map[s][e]=1,e%2&&o.push([s,e]);let a=l.getItem(r);for(let t=0;t<r.length;t++){let e=r[t];if(e==a)continue;let i=l.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],s-1,n-1]),this._stack.push([s+1,t[1],t[2],n-1]),this._stack.push([t[0],n+1,s-1,t[3]]),this._stack.push([s+1,n+1,t[2],t[3]])}},IceyMaze:class extends ut{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,s=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let n=0,r=0,o=0,a=0,h=0,c=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(n=1+2*Math.floor(l.getUniform()*(e-1)/2),r=1+2*Math.floor(l.getUniform()*(i-1)/2),h||(s[n][r]=0),!s[n][r]){this._randomize(u);do{0==Math.floor(l.getUniform()*(this._regularity+1))&&this._randomize(u),c=!0;for(let t=0;t<4;t++)if(o=n+2*u[t][0],a=r+2*u[t][1],this._isFree(s,o,a,e,i)){s[o][a]=0,s[n+u[t][0]][r+u[t][1]]=0,n=o,r=a,c=!1,h++;break}}while(!c)}}while(h+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,s[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*l.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,s,n){return!(e<1||i<1||e>=s||i>=n)&&t[e][i]}},Rogue:class extends ut{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),s=Math.floor(t/e*.25);return s<2&&(s=2),i<2&&(i=2),[s,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,s,n,r,o=l.getUniformInt(0,this._options.cellWidth-1),a=l.getUniformInt(0,this._options.cellHeight-1),h=!1;do{r=[0,2,4,6],r=l.shuffle(r);do{if(h=!1,t=r.pop(),e=o+$[8][t][0],i=a+$[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if(s=this.rooms[o][a],s.connections.length>0&&s.connections[0][0]==e&&s.connections[0][1]==i)break;n=this.rooms[e][i],0==n.connections.length&&(n.connections.push([o,a]),this.connectedCells.push([e,i]),o=e,a=i,h=!0)}}while(r.length>0&&0==h)}while(r.length>0)}_connectUnconnectedRooms(){let t,e,i,s=this._options.cellWidth,n=this._options.cellHeight;this.connectedCells=l.shuffle(this.connectedCells);for(let r=0;r<this._options.cellWidth;r++)for(let o=0;o<this._options.cellHeight;o++)if(t=this.rooms[r][o],0==t.connections.length){let a=[0,2,4,6];a=l.shuffle(a),i=!1;do{let t=a.pop(),l=r+$[8][t][0],h=o+$[8][t][1];if(!(l<0||l>=s||h<0||h>=n)){if(e=this.rooms[l][h],i=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==r&&e.connections[t][1]==o){i=!1;break}if(i)break}}while(a.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,s,n,r=this._width,o=this._height,a=this._options.cellWidth,h=this._options.cellHeight,c=Math.floor(this._width/a),u=Math.floor(this._height/h),p=this._options.roomWidth,f=this._options.roomHeight;for(let d=0;d<a;d++)for(let a=0;a<h;a++){if(i=c*d,s=u*a,0==i&&(i=1),0==s&&(s=1),t=l.getUniformInt(p[0],p[1]),e=l.getUniformInt(f[0],f[1]),a>0)for(n=this.rooms[d][a-1];s-(n.y+n.height)<3;)s++;if(d>0)for(n=this.rooms[d-1][a];i-(n.x+n.width)<3;)i++;let h=Math.round(l.getUniformInt(0,c-t)/2),_=Math.round(l.getUniformInt(0,u-e)/2);for(;i+h+t>=r;)h?h--:t--;for(;s+_+e>=o;)_?_--:e--;i+=h,s+=_,this.rooms[d][a].x=i,this.rooms[d][a].y=s,this.rooms[d][a].width=t,this.rooms[d][a].height=e;for(let n=i;n<i+t;n++)for(let t=s;t<s+e;t++)this.map[n][t]=0}}_getWallPosition(t,e){let i,s,n;return 1==e||3==e?(i=l.getUniformInt(t.x+1,t.x+t.width-2),1==e?(s=t.y-2,n=s+1):(s=t.y+t.height+1,n=s-1),this.map[i][n]=0):(s=l.getUniformInt(t.y+1,t.y+t.height-2),2==e?(i=t.x+t.width+1,n=i-1):(i=t.x-2,n=i+1),this.map[n][s]=0),[i,s]}_drawCorridor(t,e){let i,s,n,r,o=e[0]-t[0],a=e[1]-t[1],h=t[0],c=t[1],u=[],p=Math.abs(o),f=Math.abs(a),d=l.getUniform(),_=d,g=1-d;for(s=o>0?2:6,n=a>0?4:0,p<f?(i=Math.ceil(f*_),u.push([n,i]),u.push([s,p]),i=Math.floor(f*g),u.push([n,i])):(i=Math.ceil(p*_),u.push([s,i]),u.push([n,f]),i=Math.floor(p*g),u.push([s,i])),this.map[h][c]=0;u.length>0;)for(r=u.pop();r[1]>0;)h+=$[8][r[0]][0],c+=$[8][r[0]][1],this.map[h][c]=0,r[1]=r[1]-1}_createCorridors(){let t,e,i,s,n,r=this._options.cellWidth,o=this._options.cellHeight;for(let a=0;a<r;a++)for(let r=0;r<o;r++){t=this.rooms[a][r];for(let r=0;r<t.connections.length;r++)e=t.connections[r],i=this.rooms[e[0]][e[1]],i.cellx>t.cellx?(s=2,n=4):i.cellx<t.cellx?(s=4,n=2):i.celly>t.celly?(s=3,n=1):(s=1,n=3),this._drawCorridor(this._getWallPosition(t,s),this._getWallPosition(i,n))}}}};class vt{}const xt=.5*(Math.sqrt(3)-1),wt=(3-Math.sqrt(3))/6,St={Simplex:class extends vt{constructor(t=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let e=[];for(let i=0;i<t;i++)e.push(i);e=l.shuffle(e),this._perms=[],this._indexes=[];for(let i=0;i<2*t;i++)this._perms.push(e[i%t]),this._indexes.push(this._perms[i]%this._gradients.length)}get(t,e){let i,s,n,r=this._perms,o=this._indexes,a=r.length/2,l=0,h=0,c=0,p=(t+e)*xt,f=Math.floor(t+p),d=Math.floor(e+p),_=(f+d)*wt,g=t-(f-_),m=e-(d-_);g>m?(s=1,n=0):(s=0,n=1);let b=g-s+wt,y=m-n+wt,v=g-1+2*wt,x=m-1+2*wt,w=u(f,a),S=u(d,a),E=.5-g*g-m*m;if(E>=0){E*=E,i=o[w+r[S]];let t=this._gradients[i];l=E*E*(t[0]*g+t[1]*m)}let k=.5-b*b-y*y;if(k>=0){k*=k,i=o[w+s+r[S+n]];let t=this._gradients[i];h=k*k*(t[0]*b+t[1]*y)}let T=.5-v*v-x*x;if(T>=0){T*=T,i=o[w+1+r[S+1]];let t=this._gradients[i];c=T*T*(t[0]*v+t[1]*x)}return 70*(l+h+c)}}};class Et{constructor(t,e,i,s={}){this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},s),this._dirs=$[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let i=[];for(let s=0;s<this._dirs.length;s++){let n=this._dirs[s],r=t+n[0],o=e+n[1];this._passableCallback(r,o)&&i.push([r,o])}return i}}const kt={Dijkstra:class extends Et{constructor(t,e,i,s){super(t,e,i,s),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,i){let s=t+","+e;if(s in this._computed||this._compute(t,e),!(s in this._computed))return;let n=this._computed[s];for(;n;)i(n.x,n.y),n=n.prev}_compute(t,e){for(;this._todo.length;){let i=this._todo.shift();if(i.x==t&&i.y==e)return;let s=this._getNeighbors(i.x,i.y);for(let t=0;t<s.length;t++){let e=s[t],n=e[0],r=e[1];n+","+r in this._computed||this._add(n,r,i)}}}_add(t,e,i){let s={x:t,y:e,prev:i};this._computed[t+","+e]=s,this._todo.push(s)}},AStar:class extends Et{constructor(t,e,i,s={}){super(t,e,i,s),this._todo=[],this._done={}}compute(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),s=i.x+","+i.y;if(s in this._done)continue;if(this._done[s]=i,i.x==t&&i.y==e)break;let n=this._getNeighbors(i.x,i.y);for(let t=0;t<n.length;t++){let e=n[t],s=e[0],r=e[1];s+","+r in this._done||this._add(s,r,i)}}let s=this._done[t+","+e];if(s)for(;s;)i(s.x,s.y),s=s.prev}_add(t,e,i){let s=this._distance(t,e),n={x:t,y:e,prev:i,g:i?i.g+1:0,h:s},r=n.g+n.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],i=e.g+e.h;if(r<i||r==i&&s<e.h)return void this._todo.splice(t,0,n)}this._todo.push(n)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let i=Math.abs(t-this._fromX),s=Math.abs(e-this._fromY);return s+Math.max(0,(i-s)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};class Tt{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}class Ct{constructor(t,e={}){this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}setOptions(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this}setFOV(t){return this._fov=t,this._fovCache={},this}setLight(t,e,i){let s=t+","+e;return i?this._lights[s]="string"==typeof i?b(i):i:delete this._lights[s],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(t){let e={},i={},s={};for(let t in this._lights){let e=this._lights[t];i[t]=[0,0,0],v(i[t],e)}for(let t=0;t<this._options.passes;t++)this._emitLight(i,s,e),t+1!=this._options.passes&&(i=this._computeEmitters(s,e));for(let e in s){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]),s[e])}return this}_emitLight(t,e,i){for(let s in t){let n=s.split(","),r=parseInt(n[0]),o=parseInt(n[1]);this._emitLightFromCell(r,o,t[s],e),i[s]=1}return this}_computeEmitters(t,e){let i={};for(let s in t){if(s in e)continue;let n,r=t[s];if(s in this._reflectivityCache)n=this._reflectivityCache[s];else{let t=s.split(","),e=parseInt(t[0]),i=parseInt(t[1]);n=this._reflectivityCallback(e,i),this._reflectivityCache[s]=n}if(0==n)continue;let o=[0,0,0],a=0;for(let t=0;t<3;t++){let e=Math.round(r[t]*n);o[t]=e,a+=e}a>this._options.emissionThreshold&&(i[s]=o)}return i}_emitLightFromCell(t,e,i,s){let n,r=t+","+e;n=r in this._fovCache?this._fovCache[r]:this._updateFOV(t,e);for(let t in n){let e,r=n[t];t in s?e=s[t]:(e=[0,0,0],s[t]=e);for(let t=0;t<3;t++)e[t]+=Math.round(i[t]*r)}return this}_updateFOV(t,e){let i=t+","+e,s={};this._fovCache[i]=s;let n=this._options.range;return this._fov.compute(t,e,n,function(t,e,i,r){let o=r*(1-i/n);0!=o&&(s[t+","+e]=o)}.bind(this)),s}}const Pt=s,At=n,Mt=r},744:(t,e,i)=>{i.r(e),i.d(e,{default:()=>m});var s=i(379),n=i.n(s),r=i(795),o=i.n(r),a=i(569),l=i.n(a),h=i(565),c=i.n(h),u=i(216),p=i.n(u),f=i(589),d=i.n(f),_=i(65),g={};g.styleTagTransform=d(),g.setAttributes=c(),g.insert=l().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=p(),n()(_.Z,g);const m=_.Z&&_.Z.locals?_.Z.locals:void 0},379:t=>{var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var r={},o=[],a=0;a<t.length;a++){var l=t[a],h=s.base?l[0]+s.base:l[0],c=r[h]||0,u="".concat(h," ").concat(c);r[h]=c+1;var p=i(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(f);else{var d=n(f,s);s.byIndex=a,e.splice(a,0,{identifier:u,updater:d,references:1})}o.push(u)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var r=s(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<r.length;o++){var a=i(r[o]);e[a].references--}for(var l=s(t,n),h=0;h<r.length;h++){var c=i(r[h]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=l}}},569:t=>{var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},219:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Character=void 0;var s=i(402),n=function(){function t(t,e){this.game=e,this.baseRange=1,this.baseHp=1,this.baseAttack=1,this.baseArmor=1,this.sufferedDamage=0,this.x=t.x,this.y=t.y,this.goal="".concat(t.x,",").concat(t.y)}return Object.defineProperty(t.prototype,"range",{get:function(){return this.baseRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attack",{get:function(){return this.baseAttack},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"armor",{get:function(){return this.baseArmor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hp",{get:function(){return this.baseHp-this.sufferedDamage},enumerable:!1,configurable:!0}),t.prototype.isOccupying=function(t){return t.x===this.x&&t.y===this.y},t.prototype.die=function(){this.game.killCharacter(this)},t.prototype.takeDamage=function(t){this.sufferedDamage+=t,this.hp<=0&&this.die()},Object.defineProperty(t.prototype,"path",{get:function(){var t=this.goal.split(","),e=this.pathTo({x:Number.parseInt(t[0],10),y:Number.parseInt(t[1],10)});if(e.length)return e;for(var i=0,s=this.game.getSheepPositions(this);i<s.length;i++){var n=s[i],r=this.pathTo(n);if(r.length)return r}return[]},enumerable:!1,configurable:!0}),t.prototype.pathTo=function(t){var e=new s.Path.AStar(t.x,t.y,this.aStarCallback.bind(this),{topology:8}),i=[];return e.compute(this.x,this.y,(function(t,e){i.push([t,e])})),i.shift(),i},t.prototype.aStarCallback=function(t,e){return t===this.x&&e===this.y||this.game.isWalkableTile(t,e)},t}();e.Character=n},401:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Demon=void 0;var r=i(373),o=function(){function t(){this.burningSpaces=0,this.speed=10,this.hasWarned=!1}return t.prototype.getSpeed=function(){return this.speed},t.prototype.act=function(){return s(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.hasWarned?[3,2]:[4,(0,r.triggerDemonWarning)()];case 1:t.sent(),this.hasWarned=!0,t.label=2;case 2:return this.burningSpaces++,[2]}}))}))},t}();e.Demon=o},275:function(t,e,i){var s,n=this&&this.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Enemy=void 0;var a=i(854),l=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.initialPosition="".concat(e.x,",").concat(e.y),s.speed=100,s.baseVisibility=3,s}return n(e,t),Object.defineProperty(e.prototype,"visibility",{get:function(){return this.baseVisibility},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),e.prototype.getSpeed=function(){return this.speed},e.prototype.getClosestSheepInRange=function(){for(var t,e=1;e<=this.visibility;e++){for(var i=0,s=this.game.getSheepPositions();i<s.length;i++){var n=s[i];if((0,a.isWithin)(this.position,n,e)){t=this.game.getSheepAt(n);break}}if(t)break}return t},e.prototype.getGoal=function(){return(0,a.getPositionFromCoords)(this.goal)},e.prototype.act=function(){return r(this,void 0,void 0,(function(){var t,e,i,s,n;return o(this,(function(r){return(t=this.getClosestSheepInRange())&&(this.goal="".concat(t.position.x,",").concat(t.position.y)),t&&(0,a.isWithin)(this.position,this.getGoal(),this.range)&&!t.isHidden()?t.takeDamage(this.attack):(0,a.isWithin)(this.getGoal(),this.position,this.baseVisibility)&&!(0,a.isWithin)(this.getGoal(),this.position,0)||this.goal===this.initialPosition?((e=this.path)[0]&&!this.game.isOccupiedTile(e[0][0],e[0][1])&&(i=e[0],s=i[0],n=i[1],this.x=s,this.y=n),this.game.drawFov()):this.goal=this.initialPosition,[2]}))}))},e}(i(219).Character);e.Enemy=l},736:function(t,e){var i=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Pause=void 0;var n=function(){function t(){var t=this;this.speed=1e4,this.resolve=function(){},this.resolver=new Promise((function(e){t.resolve=function(){return e(null)}}))}return t.prototype.getSpeed=function(){return this.speed},t.prototype.act=function(){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.resolver];case 1:return t.sent(),[2]}}))}))},t}();e.Pause=n},954:function(t,e,i){var s,n=this&&this.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Peasant=void 0;var r=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.baseHp=10,s}return n(e,t),e}(i(275).Enemy);e.Peasant=r},473:function(t,e,i){var s,n=this&&this.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Sheep=void 0;var a=i(601),l=i(854),h=i(593),c=function(t){function e(e,i,s,n){var r=t.call(this,{x:e,y:i},s)||this;return r.status=a.Status.QUEUED,r.xp=0,r.name=(0,h.getGoblinName)(),r.color=(0,h.getRandomGreen)(),r.baseVisibility=8,r.speed=100,r.map=n,r}return n(e,t),e.prototype.setGoal=function(t,e){this.goal="".concat(t,",").concat(e)},Object.defineProperty(e.prototype,"level",{get:function(){for(var t=1,e=this.xp;e>0;)e-=t++;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this.baseVisibility},enumerable:!1,configurable:!0}),e.prototype.getClosestEnemyWithinRange=function(){for(var t,e=1;e<=this.visibility;e++){for(var i=0,s=this.game.getEnemyPositions();i<s.length;i++){var n=s[i];if((0,l.isWithin)(this.position,n,e)){t=this.game.getEnemyAt(n);break}}if(t)break}return t},e.prototype.gainXp=function(t){this.xp+=t},e.prototype.act=function(){return r(this,void 0,void 0,(function(){var t,e,i,s,n,r,a;return o(this,(function(o){return(t=this.getClosestEnemyWithinRange())&&(0,l.isWithin)(this.position,t,this.range)?(t.takeDamage(this.attack),this.gainXp(this.attack),[2]):(e=this.path,(i=e[0]&&!this.game.isOccupiedTile(e[0][0],e[0][1]))&&(s=e[0],n=s[0],r=s[1],this.x=n,this.y=r),this.game.drawFov(),i&&(a=this.map.getEndGate(),this.x===a.x&&this.y===a.y&&this.game.handleSheepAtGate(this)),[2])}))}))},e.prototype.isHidden=function(){var t=this.map.getStartGate();return(0,l.isWithin)(this.position,{x:t.x,y:t.y},0)},e.prototype.getSpeed=function(){return this.speed},e.prototype.draw=function(t){globalThis.display.draw(this.x,this.y,a.symbols.SHEEP,this.color,t)},e}(i(219).Character);e.Sheep=c},601:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Status=e.colors=e.times=e.maxLevel=e.topOffset=e.board=e.symbols=void 0,e.symbols={ENEMY:"⚔",PEASANT:"ψ",FLAG:"⚑",GATE:"∩",SHEEP:"웃",SPACE_WALL:"█",SPACE_OPEN:" "},e.board={width:30,height:30},e.topOffset=3,e.maxLevel=10,e.times={TURN_DELAY:200},e.colors={BACKGROUND_GATE:"orange",BACKGROUND_VISIBLE_PASSABLE:"#dfdfdf",BACKGROUND_VISIBLE_IMPASSABLE:"#4D4D4D",BACKGROUND_NONVISIBLE_PASSABLE:"#8C8C8C",BACKGROUND_NONVISIBLE_IMPASSABLE:"#4D4D4D",BACKGROUND_UNDISCOVERED:"#4D4D4D",DEMON_FIRE_1:"#973716",DEMON_FIRE_2:"#cd4606",DEMON_FIRE_3:"#ec760c",DEMON_FIRE_4:"#ffae34",DEMON_FIRE_5:"#feec85",FLAG:"#FA4ED6",GATE:"rebeccapurple"},(i=e.Status||(e.Status={}))[i.ACTIVE=0]="ACTIVE",i[i.DEAD=1]="DEAD",i[i.QUEUED=2]="QUEUED",i[i.SAFE=3]="SAFE"},33:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Controls=void 0;var s=i(373),n=i(509),r=function(){function t(t){this.game=t,this.startingTouchCell=null,this.movedTouchCell=null,globalThis.gameElement.ontouchstart=this.handleTouchStart.bind(this),globalThis.gameElement.ontouchcancel=this.handleTouchCancel.bind(this),globalThis.gameElement.ontouchmove=this.handleTouchMove.bind(this),globalThis.gameElement.ontouchend=this.handleTouchEnd.bind(this);var e=document.getElementById("character-list-button");e&&(e.classList.add("open"),e.ontouchstart=this.handleCharacterListOpen.bind(this));var i=document.getElementById("character-list-cancel-button");i&&(i.ontouchstart=this.handleCharacterListClose.bind(this))}return t.prototype.handleCharacterListOpen=function(){this.game.pauseTimer(),(0,s.toggleCharacterListVisibility)(this.game.sheepAlive)},t.prototype.handleCharacterListClose=function(){(0,s.toggleCharacterListVisibility)(this.game.sheepAlive),this.game.unpauseTimer()},t.prototype.handleTouchStart=function(t){t.preventDefault(),this.startingTouchCell=(0,n.getPosition)(t)},t.prototype.handleTouchCancel=function(t){t.preventDefault(),this.startingTouchCell=null,this.movedTouchCell=null},t.prototype.handleTouchMove=function(t){t.preventDefault(),this.movedTouchCell=(0,n.getPosition)(t)},t.prototype.handleTouchEnd=function(t){if(t.preventDefault(),this.startingTouchCell){var e=this.movedTouchCell?this.movedTouchCell:this.startingTouchCell;this.matchesStartingPosition(e)&&this.game.handleSelect(e.x,e.y),this.startingTouchCell=null,this.movedTouchCell=null}},t.prototype.matchesStartingPosition=function(t){return!(!this.startingTouchCell||!t)&&t.x===this.startingTouchCell.x&&t.y===this.startingTouchCell.y},t}();e.Controls=r},373:(t,e)=>{function i(){var t=document.getElementById("warning-message");t&&t.classList.replace("fade-in-animation","fade-out-animation")}Object.defineProperty(e,"__esModule",{value:!0}),e.setLevel=e.toggleCharacterListVisibility=e.triggerDemonWarning=void 0,e.triggerDemonWarning=function(){var t=document.getElementById("warning-message");t&&(t.classList.remove("fade-out-animation"),t.classList.add("fade-in-animation"),setTimeout(i,2500))},e.toggleCharacterListVisibility=function(t){var e=document.getElementById("character-list-modal");if(e){var i="block"===e.style.display;if(!i){var s=document.getElementById("character-list");if(s){var n=t.map((function(t){return'<div class="sheep"><img class="sheep-head" src="./images/gooblin-head.svg" /><span>'.concat(t.name," - ").concat(t.x,", ").concat(t.y," - Level ").concat(t.level,"</span></div>")})).reduce((function(t,e){return t+e}),"");s.innerHTML=n}}e.style.display=i?"none":"block"}},e.setLevel=function(t){var e=document.getElementById("level-title");e&&(e.innerHTML="Level ".concat(t))}},769:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var r=i(402),o=i(401),a=i(736),l=i(954),h=i(473),c=i(601),u=i(33),p=i(373),f=i(999),d=i(854),_=i(593),g=function(){function t(t,e){var i=this;new u.Controls(this),this.level=0,this.map=new f.GameMap(t,e),this.visibleTiles={},this.flag={x:0,y:0},this.sheep=[],Array.from(Array(21).keys()).forEach((function(){i.sheep.push(new h.Sheep(0,0,i,i.map))})),this.scheduler=new r.Scheduler.Speed,this.enemies=[],this.demon=new o.Demon}return Object.defineProperty(t.prototype,"sheepAlive",{get:function(){return this.sheep.filter((function(t){return t.status!==c.Status.DEAD}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheepActive",{get:function(){return this.sheep.filter((function(t){return t.status===c.Status.ACTIVE}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheepQueued",{get:function(){return this.sheep.filter((function(t){return t.status===c.Status.QUEUED}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheepArrived",{get:function(){return this.sheep.filter((function(t){return t.status===c.Status.SAFE}))},enumerable:!1,configurable:!0}),t.prototype.isTileFreeOfSheep=function(t,e){return-1===this.sheepActive.findIndex((function(i){return i.x===t&&i.y===e}))},t.prototype.handleSelect=function(t,e){this.map.isNonWallTile(t,e)&&this.map.isSeenTile(t,e)&&!(0,d.isInFire)(e,this.demon)&&this.setFlag(t,e)},t.prototype.handleSheepAtGate=function(t){t.status=c.Status.SAFE,0===this.sheepActive.length&&this.handleLevelEnd()},t.prototype.getSheepPositions=function(t){return this.sheepActive.filter((function(e){return t!==e})).map((function(t){return{x:t.x,y:t.y}}))},t.prototype.getSheepAt=function(t){return this.sheepActive.find((function(e){return e.isOccupying(t)}))},t.prototype.getEnemyPositions=function(){return this.enemies.map((function(t){return{x:t.x,y:t.y}}))},t.prototype.getEnemyAt=function(t){return this.enemies.find((function(e){return e.isOccupying(t)}))},t.prototype.isWalkableTile=function(t,e){return!this.isOccupiedTile(t,e)&&this.map.isNonWallTile(t,e)},t.prototype.isOccupiedTile=function(t,e){return this.sheepActive.some((function(i){return i.isOccupying({x:t,y:e})}))||this.enemies.some((function(i){return i.isOccupying({x:t,y:e})}))},t.prototype.redrawTile=function(t,e){var i,s=c.symbols.SPACE_OPEN,n="#000";this.sheepActive.some((function(i){return i.isOccupying({x:t,y:e})}))?(s=c.symbols.SHEEP,n=(null===(i=this.getSheepAt({x:t,y:e}))||void 0===i?void 0:i.color)||"#000"):this.enemies.some((function(i){return i.isOccupying({x:t,y:e})}))?s=this.enemies.find((function(i){return i.isOccupying({x:t,y:e})}))instanceof l.Peasant?c.symbols.PEASANT:c.symbols.ENEMY:this.flag.x===t&&this.flag.y===e?(n=c.colors.FLAG,s=c.symbols.FLAG):this.map.matchesGate(t,e)&&(n=c.colors.GATE,s=c.symbols.GATE),globalThis.display.draw(t,e,s,n,this.getTileBackgroundColor(t,e))},t.prototype.getTileBackgroundColor=function(t,e){return this.map.isNonWallTile(t,e)?this.map.matchesGate(t,e)?c.colors.BACKGROUND_GATE:this.visibleTiles["".concat(t,",").concat(e)]?c.colors.BACKGROUND_VISIBLE_PASSABLE:c.colors.BACKGROUND_NONVISIBLE_PASSABLE:c.colors.BACKGROUND_NONVISIBLE_IMPASSABLE},t.prototype.spawnPeasant=function(){for(var t=function(t){var i=e.map.getRandomPassableTile();if(!e.sheepActive.some((function(t){return t.isOccupying({x:i.x,y:i.y})}))&&!e.enemies.some((function(t){return t.isOccupying({x:i.x,y:i.y})})))return{value:new l.Peasant({x:i.x,y:i.y},e)}},e=this,i=0;i<=1e3;i++){var s=t();if("object"==typeof s)return s.value}throw new Error("no valid location")},t.prototype.pauseTimer=function(){this.scheduler.add(new a.Pause,!1,0)},t.prototype.unpauseTimer=function(){var t;(null===(t=this.scheduler._current)||void 0===t?void 0:t.resolve)&&this.scheduler._current.resolve()},t.prototype.drawFov=function(){var t=this,e=new r.FOV.PreciseShadowcasting(this.map.isNonWallTile.bind(this.map));this.map.drawTiles(),this.visibleTiles={},this.sheepActive.forEach((function(i){e.compute(i.x,i.y,i.visibility,(function(e,i){t.map.seeTile("".concat(e,",").concat(i)),t.visibleTiles["".concat(e,",").concat(i)]=!0}))})),Object.keys(this.visibleTiles).forEach((function(e){var i=e.split(","),s=i[0],n=i[1];t.redrawTile(Number.parseInt(s,10),Number.parseInt(n,10))})),this.redrawTile(this.flag.x,this.flag.y),this.redrawTile(this.map.getStartGate().x,this.map.getStartGate().y);var i=this.map.getEndGate();(this.map.isSeenTile(i.x,i.y)||(0,_.isDebug)())&&this.redrawTile(i.x,i.y),this.map.drawDemonFire(this.demon.burningSpaces)},t.prototype.killCharacter=function(t){this.scheduler.remove(t),t instanceof h.Sheep&&(t.status=c.Status.DEAD),(0,_.filterInPlace)(this.enemies,(function(e){return t!==e})),this.redrawTile(t.x,t.y)},t.prototype.setFlag=function(t,e){var i=this.flag.x,s=this.flag.y;this.flag={x:t,y:e},this.redrawTile(t,e),this.redrawTile(i,s),this.sheep.forEach((function(i){i.setGoal(t,e)}))},t.prototype.handleLevelEnd=function(){0!==this.sheepArrived.length&&this.scheduler.clear()},t.prototype.spawnSheep=function(){if(this.sheepQueued.length){var t=this.sheepQueued[0],e=this.map.getStartGate();t.x=e.x,t.y=e.y,t.status=c.Status.ACTIVE,this.scheduler.add(t,!0,0)}},t.prototype.populateEnemies=function(){var t=this;this.enemies.length=0,this.enemies.push(this.spawnPeasant()),this.enemies.forEach((function(e){return t.scheduler.add(e,!0)})),this.demon=new o.Demon,this.scheduler.add(this.demon,!0,1)},t.prototype.positionFlag=function(){var t=this.map.getStartGate();this.setFlag(t.x,t.y)},t.prototype.nextTurn=function(){return s(this,void 0,void 0,(function(){var t,e,i=this;return n(this,(function(s){switch(s.label){case 0:return(t=this.scheduler.next())?(e=this.map.getStartGate(),0!==this.sheepQueued.length&&this.isTileFreeOfSheep(e.x,e.y)&&this.spawnSheep(),this.sheepActive.length?t!==this.sheepActive[0]?[3,2]:[4,(0,_.waitFor)(c.times.TURN_DELAY)]:[3,3]):[2,!1];case 1:s.sent(),s.label=2;case 2:this.sheep.filter((function(t){return(0,d.isInFire)(t.y,i.demon)&&t.status!==c.Status.SAFE})).forEach((function(t){return i.killCharacter(t)})),s.label=3;case 3:return[4,t.act()];case 4:return s.sent(),[2,!0]}}))}))},t.prototype.isLost=function(){return this.sheep.every((function(t){return t.status===c.Status.DEAD}))},t.prototype.isWon=function(){return this.level>=c.maxLevel},t.prototype.resetAllSheep=function(){var t=this;this.sheep.forEach((function(e){e.status!==c.Status.SAFE&&e.status!==c.Status.QUEUED||(e.status=c.Status.QUEUED,e.x=t.map.getStartGate().x,e.y=t.map.getStartGate().y)}))},t.prototype.startNextLevel=function(){return s(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:this.scheduler.clear(),(0,p.setLevel)(++this.level),this.map.init(),this.resetAllSheep(),this.populateEnemies(),this.positionFlag(),(0,_.clearRotScreen)(),e.label=1;case 1:return[4,this.nextTurn()];case 2:return!(t=e.sent())||0===this.sheepActive.length&&0===this.sheepQueued.length?(console.debug("breaking due to no ".concat(t?"sheep":"actors")),[3,3]):[3,1];case 3:return[2]}}))}))},t}();e.Game=g},999:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameMap=void 0;var s=i(402),n=i(601),r=i(43),o=i(593),a=function(){function t(t,e){this.width=t,this.height=e,this.tiles=[],this.seenTiles={},this.startGatePosition={x:0,y:0},this.endGatePosition={x:0,y:0},this.init()}return Object.defineProperty(t.prototype,"numberOfPassableTiles",{get:function(){return this.tiles.reduce((function(t,e){return t+e.filter((function(t){return t.isPassable})).length}),0)},enumerable:!1,configurable:!0}),t.prototype.init=function(){for(var t=this,e=0,i=Object.getOwnPropertyNames(this.seenTiles);e<i.length;e++){var o=i[e];delete this.seenTiles[o]}this.tiles.length=0;var a=new s.Map.Cellular(this.width,this.height),l=function(e,i,s){var o=e,a=i+n.topOffset;t.tiles[o]||(t.tiles[o]=[]),t.tiles[o][a]=new r.Tile(o,a,1===s)};a.randomize(.55),Array.from(Array(5).keys()).forEach((function(){a.create(l.bind(t))})),a.connect(l.bind(this),1);var h=this.getRandomTileFromRow(this.tiles[n.topOffset].length-1,!1);this.startGatePosition={x:h.x,y:h.y};var c=this.getRandomTileFromRow(n.topOffset,!0);this.endGatePosition={x:c.x,y:c.y}},t.prototype.getRandomPassableTile=function(){for(var t=0;t<=1e3;t++){var e=(0,o.getRandomNumber)(0,this.tiles.length-1),i=(0,o.getRandomNumber)(0,this.tiles[0].length-1),s=this.tiles[e][i];if((null==s?void 0:s.isPassable)&&!this.matchesGate(s.x,s.y))return s}throw new Error("Could not find a valid tile")},t.prototype.getStartGate=function(){return this.tiles[this.startGatePosition.x][this.startGatePosition.y]},t.prototype.getEndGate=function(){return this.tiles[this.endGatePosition.x][this.endGatePosition.y]},t.prototype.matchesGate=function(t,e){return this.startGatePosition.x===t&&this.startGatePosition.y===e||this.endGatePosition.x===t&&this.endGatePosition.y===e},t.prototype.drawDemonFire=function(t){for(var e=[n.colors.DEMON_FIRE_5,n.colors.DEMON_FIRE_4,n.colors.DEMON_FIRE_3,n.colors.DEMON_FIRE_2,n.colors.DEMON_FIRE_1],i=0;i<t;i++)for(var s=0;s<this.tiles.length;s++){var r=e.length*i/t+.02;globalThis.display.draw(s,this.tiles[1].length-1-i,"",null,e[Math.random()>.5?Math.ceil(r):Math.floor(r)])}},t.prototype.drawTiles=function(){var t=this;this.tiles.forEach((function(e){return e.forEach((function(e){t.seenTiles["".concat(e.x,",").concat(e.y)]&&e.draw()}))}))},t.prototype.isSeenTile=function(t,e){return!!this.seenTiles["".concat(t,",").concat(e)]},t.prototype.isNonWallTile=function(t,e){var i;return!!(null===(i=this.getTile(t,e))||void 0===i?void 0:i.isPassable)},t.prototype.seeTile=function(t){var e;if(void 0===this.seenTiles[t]){var i=t.split(","),s=i[0],n=i[1];this.seenTiles[t]=(null===(e=this.tiles[s])||void 0===e?void 0:e[n])||null}},t.prototype.getTile=function(t,e){var i,s;return null===(s=null===(i=this.tiles)||void 0===i?void 0:i[t])||void 0===s?void 0:s[e]},t.prototype.getRandomTileFromRow=function(t,e){for(var i=void 0,s=function(t){var e=n.tiles.filter((function(e){return e[t].isPassable}));e.length&&(i=e[Math.floor(Math.random()*e.length)][t])},n=this,r=t;!i;r+=e?1:-1)s(r);return i},t}();e.GameMap=a},607:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),i(744);var r=i(402),o=i(601),a=i(769),l=i(318),h=o.board.width,c=o.board.height;globalThis.height=c+3,globalThis.display=new r.Display({width:o.board.width,height:globalThis.height,fg:"#000",spacing:2}),window.addEventListener("load",(function(){var t=globalThis.display.getContainer();if(t){var e=document.getElementById("game");e&&(globalThis.gameElement=e,e.appendChild(t),e.onwheel=function(t){t.preventDefault()})}new l.SceneManager((function(){return s(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:t=new a.Game(h,c),e.label=1;case 1:return t.isLost()||t.isWon()?[3,3]:[4,t.startNextLevel()];case 2:return e.sent(),[3,1];case 3:return globalThis.display._tick(),[2,t.isWon()&&!t.isLost()]}}))}))}))})),globalThis.goblinNames=["Aaftaax","Adlirg","Aggohx","Aggu","Ags","Ailluilas","Akkosz","Alkar","Along","Ant Strong","Arkus","Atmong","Baats","Bait","Bankit","Bannuk","Bebkuird","Belch Loud","Bentarms","Bigchin","Billywig","Biotmaart","Bisiolmea","Blomvez","Blur","Blyts","Bodrol","Bogragg","Boipsah","Brainmush","Brevzethee","Brias","Brodnott","Bruil","Bruivor","Brunknas","Brwaos","Bugragg","Buibsiort","Cagrerk","Ceel","Cekx","Cenqea","Charbazz","Chor","Chowder","Churkigs","Cigonk","Clalkard","Claz","Clietmyn","Clukzaakt","Craang","Crasoas","Creahx","Creahx","Crict","Cruszuil","Del","Delduk","Depolm","Derigz","Dies Horribly","Donais","Drarm","Dreesb","Drejask","Drionvogz","Drisz","Druics","Duggart","Dullarms","Dusk Brighty","Dyrd","Eagansa","Eart","Eglus","Envygz","Erioos","Erm","Ernuk","Farnaff","Farrod","Fatleg","Filragg","Fiokvas","Fiolx","Foiz","Frailtooth","Fralk","Freanaact","Freesrylb","Freias","Fribdalb","Frilk","Frold","Frursard","Fugh","Fugh","Furguss","Furliarm","Furrak","Gag","Garlaff","Garrast","Gary Goodgoblin","Geemusz","Gehkiaz","Gim Seobang Dokkaebi","Glahuird","Glevzaagz","Gliehbiabs","Gliosb","Globarm","Glymzogs","Gnaalsia","Gnaalsia","Gnianagia","Go Dokkaebi","GoldaGoblin","Gorluk","Goutmaw","Graggrat","Gragnok","Gralbianq","Granguss","Grapezz Shrillsteam","Grejia","Grikveeld","Grinkrat","Grishnar","Grizzle","Gruigs","Grukgrat","Grutaat","Guix Saltyfault","Gully","Gurgrot","Gurnuff","Gux","Harzokx","Heakt","Hiah","Hiord","Hokoiszea","Htejas","Huiglioft","Huntero","Hurrub","Iazz","Iharxa","Ilsung","Iq","Ir","IzIz","Izqird Grimmind","Jact","Jan","Jiarziog","Jiaspas","Jisriank","Jurt","Jykeegs","Jykeegs","Kalkuig","Kalo","Karguff","Karnott","Keart","Khothi","Kiengi","Klialiabs","Klolbort","Klusez","Kmasoas","Koglig","Kragraff","Krevzaard","Kroberd","Krordois","Krugnott","Kruic","Kuhzizz","Kuilogz","Kuqi","Kurluk","Kyuasas","Lagnuff","Larnar","Liocs","Lmaysu","Lodvel","Lognerk","Louse","Lurd","Lurkit","Lymzehx","Lysdiez","Mida","Milvok","Mitemouth","Moldnose","Mongrel","Muaskas","Muchot","Mudmug","Munkle Wrenchsnap","Nadkrus","Nadrak","Naglok","Nagnus","Niafzia","Nibras","Nilx","Nindi Rapidflow","Nunoilee","Nurgras","Nurteyun","Nyajas","Obur","Oenun Dokkaebi","Olk","Olteqe","Omtuinqea","Onk","Opasas","Owlball","Pagneeg","Pats","Pauli","Peon","Phalruiltai","Pheattung","Phesx","Piz","Plegrirm","Plekniesb","Pler","Pmasyg","Pozzik","Pradfoic","Prarx","Prizokx","Prorreekz","Pryhxa","Prysvoikx","Pudzekt","Pyzge Meanbelt","Qeassa","Qebranda","Qeldar","Qiang","Qoldin","Quirulkee","Qywjais","Raazguirk","Ragrat","Ranluk","Reenk","Revilgaz","Revilgaz","Rit","Riti Cheapboot","Rodgott","Rodrast","Ronxa","Roztiokz","Rulgran","Shake Spear","ShakeSpear","Silkeqia","Sionxee","Sjasooas","Slaabzacs","Slart","Slek","Slilse","Sliszeabs","Slozabs","Snailnose","Snotear","Srats","Sreevuld","Srekt","Sroisvuq","Srufbih","Srult","Stiasnic","Stinkarm","Stolb","Stot","Strild","Struiveect","Sweerx","Swelm","Tes","Thelx","Thren","Tik","Tirx","Tjoaks","Toenail","Tribuiq","Trirta","Trirzex","Trung","Tugdark","Ubs","Ugkit","Uigz","Uiheald","Uil","Ukoasla","Ulnat","Ulnuff","Umialk","Umtash","Unjaks","Urlus","Ux","Vaming","Vasegz","Vasse","Verdrak","Vigdarg","Voguz","Voisax","Vragek","Vregroqai","Vrer","Vrestolt","Vriozz","Vrudgark","Vrur","Vrutlus","Vyasoas","Wags","Waz Powertooth","Weasel","Wernaal","Wiaisokas","Wonk","Wraathai","Wriseel","Wukx","Xect","Xeebboq","Xiagluld","Xiasokas","Xiogdurm","Yameeka","Ygs","Yoasas","Yraark","Zarl","Zear","Zeekleerk","Zigz","Zmaskas","Zok","Zoz","Zrurdok","Zrux","Zryl","Zudal"]},854:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isInFire=e.getPositionFromCoords=e.isWithin=void 0,e.isWithin=function(t,e,i){return Math.abs(t.x-e.x)<i+1&&Math.abs(t.y-e.y)<i+1},e.getPositionFromCoords=function(t){var e=t.split(","),i=e[0],s=e[1];return{x:Number.parseInt(i,10),y:Number.parseInt(s,10)}},e.isInFire=function(t,e){return t>=globalThis.height-e.burningSpaces}},318:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.SceneManager=void 0;var r=i(593),o=function(){function t(t){this.gameStartCallback=t,(0,r.isDebug)()?this.startGame():this.init()}return t.prototype.init=function(){var t=document.getElementById("level-title");t&&t.classList.remove("open"),(0,r.clearCanvas)(),(0,r.drawSomeText)("Goblin Mode",void 0,void 0,{textAlign:"center",color:"orange"}),globalThis.gameElement.ontouchstart=this.startGame.bind(this)},t.prototype.showEndScreen=function(t){return s(this,void 0,void 0,(function(){var e;return n(this,(function(i){return(0,r.clearCanvas)(),e=t?"The goblins survived!":"All your gobbos died.",(0,r.drawSomeText)(e,void 0,void 0,{textAlign:"center",color:"orange"}),[2,new Promise((function(t){globalThis.gameElement.ontouchstart=function(){return t()}}))]}))}))},t.prototype.startGame=function(){var t;return s(this,void 0,void 0,(function(){var e,i;return n(this,(function(s){switch(s.label){case 0:return(e=document.getElementById("level-title"))&&e.classList.add("open"),(0,r.clearCanvas)(),(0,r.isDebug)()?[3,2]:[4,null===(t=document.querySelector("body"))||void 0===t?void 0:t.requestFullscreen()];case 1:s.sent(),s.label=2;case 2:return[4,this.gameStartCallback()];case 3:return i=s.sent(),[4,this.showEndScreen(i)];case 4:return s.sent(),this.init(),[2]}}))}))},t}();e.SceneManager=o},43:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tile=void 0;var s=i(601),n=function(){function t(t,e,i){this.x=t,this.y=e,this.isPassable=i}return t.prototype.draw=function(){globalThis.display.draw(this.x,this.y,this.isPassable?s.symbols.SPACE_OPEN:"",null,this.isPassable?s.colors.BACKGROUND_NONVISIBLE_PASSABLE:s.colors.BACKGROUND_NONVISIBLE_IMPASSABLE)},t}();e.Tile=n},509:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getPosition=void 0,e.getPosition=function(t){var e=globalThis.display.eventToPosition(t);return{x:e[0],y:e[1]}}},593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getRandomNumber=e.getRandomColor=e.getRandomGreen=e.getGoblinName=e.waitFor=e.drawSomeText=e.clearCanvas=e.clearRotScreen=e.isDebug=e.filterInPlace=void 0,e.filterInPlace=function(t,e){for(var i=0,s=0;i<t.length;)e(t[i])&&(t[s]=t[i],s++),i++;t.length=s},e.isDebug=function(){return null!==new URL(window.location.href).searchParams.get("debug")},e.clearRotScreen=function(){var t;(null===(t=globalThis.display.getContainer())||void 0===t?void 0:t.getContext("2d"))&&globalThis.display.clear()},e.clearCanvas=function(){var t,e=null===(t=globalThis.display.getContainer())||void 0===t?void 0:t.getContext("2d");if(e){var i=e.fillStyle;e.fillStyle="black",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=i}},e.drawSomeText=function(t,e,i,s){var n,r=null===(n=globalThis.display.getContainer())||void 0===n?void 0:n.getContext("2d");if(r){var o=r.textAlign,a=r.fillStyle,l=r.font;r.textAlign=(null==s?void 0:s.textAlign)||"left",r.fillStyle=(null==s?void 0:s.color)||"white",r.font=(null==s?void 0:s.font)||"50px serif",r.fillText(t,e||r.canvas.width/2,i||r.canvas.height/2),r.textAlign=o,r.fillStyle=a,r.font=l}},e.waitFor=function(t){var e,i=new Promise((function(t){e=t}));return setTimeout((function(){return e()}),t),i},e.getGoblinName=function(){return globalThis.goblinNames=function(t){for(var e,i,s=t.length;0!==s;)i=Math.floor(Math.random()*s),s--,e=[t[i],t[s]],t[s]=e[0],t[i]=e[1];return t}(globalThis.goblinNames),globalThis.goblinNames.pop()||""},e.getRandomGreen=function(){return"rgb(0, ".concat(130*Math.random()+80,", 0)")},e.getRandomColor=function(){return"#".concat(Math.floor(16777215*Math.random()).toString(16))},e.getRandomNumber=function(t,e){return Math.floor(Math.random()*(e-t+1))+t}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0,i(607)})();